<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Dashboard | Bot WhatsApp</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="/style.css" />
    <link rel="icon" href="/favicon.svg" />
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  </head>
  <body class="bg-dark p-4">
    <div class="toast-container position-fixed top-0 end-0 p-3" style="z-index: 1100"></div>

    <div class="container">
      <div class="modal fade" id="modalQr" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title">üîë Conectar WhatsApp</h5>
              <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body text-center"><div id="qrcode"></div></div>
          </div>
        </div>
      </div>

      <div class="modal fade" id="modalTeste" tabindex="-1">
        <div class="modal-dialog modal-lg">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title">üß™ Mensagem de Teste Gerada</h5>
              <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
              <div id="conteudo-teste" class="alert alert-info"></div>
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Manter (Fechar)</button>
              <button type="button" class="btn btn-danger" id="btn-descartar-teste">Descartar Mensagem</button>
            </div>
          </div>
        </div>
      </div>

      <div class="modal fade" id="modalConfirm" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="confirmTitle">‚ö†Ô∏è Confirma√ß√£o</h5>
              <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body"><p id="confirmQuestion">Voc√™ tem certeza?</p></div>
            <div class="modal-footer">
              <button type="button" class="btn btn-secondary" id="confirmCancelBtn">Cancelar</button
              ><button type="button" class="btn btn-primary" id="confirmOkBtn">Confirmar</button>
            </div>
          </div>
        </div>
      </div>

      <header class="text-center mb-4">
        <h1 class="mb-4">ü§ñ Dashboard</h1>
        <ul class="nav nav-tabs mb-4" id="tabs">
          <li class="nav-item">
            <a class="nav-link active" data-bs-toggle="tab" href="#dashboard">Dashboard</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" data-bs-toggle="tab" href="#grupos">Gerenciar Grupos</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" data-bs-toggle="tab" href="#prompts">Prompts IA</a>
          </li>
        </ul>
        <div class="card card-dark p-3">
          <div class="d-flex gap-2 flex-wrap justify-content-center">
            <button class="btn btn-success" onclick="iniciarBot()" id="btn-iniciar">
              <svg
                class="w-6 h-6 text-gray-800 dark:text-white"
                aria-hidden="true"
                xmlns="http://www.w3.org/2000/svg"
                width="24"
                height="24"
                fill="currentColor"
                viewBox="0 0 24 24"
              >
                <path fill-rule="evenodd" d="M8.6 5.2A1 1 0 0 0 7 6v12a1 1 0 0 0 1.6.8l8-6a1 1 0 0 0 0-1.6l-8-6Z" clip-rule="evenodd" />
              </svg>
              Iniciar
            </button>
            <button class="btn btn-danger" onclick="pararBot()">
              <svg
                class="w-6 h-6 text-gray-800 dark:text-white"
                aria-hidden="true"
                xmlns="http://www.w3.org/2000/svg"
                width="24"
                height="24"
                fill="currentColor"
                viewBox="0 0 24 24"
              >
                <path d="M7 5a2 2 0 0 0-2 2v10a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V7a2 2 0 0 0-2-2H7Z" />
              </svg>
              Parar
            </button>
            <div class="input-group w-auto">
              <span class="input-group-text">‚è±Ô∏è</span
              ><input type="number" id="intervalo" class="form-control" placeholder="Intervalo (min)" />
            </div>
            <div class="input-group w-auto">
              <span class="input-group-text">üê¢</span><input type="number" id="delay" class="form-control" placeholder="Delay (ms)" />
            </div>
            <button class="btn btn-warning" onclick="atualizarConfig()">
              <svg
                class="w-6 h-6 text-gray-800 dark:text-white"
                aria-hidden="true"
                xmlns="http://www.w3.org/2000/svg"
                width="24"
                height="24"
                fill="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  fill-rule="evenodd"
                  d="M5 3a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V7.414A2 2 0 0 0 20.414 6L18 3.586A2 2 0 0 0 16.586 3H5Zm10 11a3 3 0 1 1-6 0 3 3 0 0 1 6 0ZM8 7V5h8v2a1 1 0 0 1-1 1H9a1 1 0 0 1-1-1Z"
                  clip-rule="evenodd"
                />
              </svg>
              Salvar
            </button>
            <button id="botao-acao" class="btn btn-outline-primary" onclick="acaoBot()">
              <svg
                class="w-[30px] h-[30px] text-gray-800 dark:text-white"
                aria-hidden="true"
                xmlns="http://www.w3.org/2000/svg"
                width="24"
                height="24"
                fill="none"
                viewBox="0 0 24 24"
              >
                <path
                  stroke="currentColor"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="1.9"
                  d="M17.651 7.65a7.131 7.131 0 0 0-12.68 3.15M18.001 4v4h-4m-7.652 8.35a7.13 7.13 0 0 0 12.68-3.15M6 20v-4h4"
                />
              </svg>
              Verificando...
            </button>
          </div>
        </div>
      </header>

      <div class="tab-content">
        <div class="tab-pane fade show active" id="dashboard">
          <div class="card card-dark mb-4">
            <h4 class="mb-3">üñ•Ô∏è Logs do Bot</h4>
            <div id="logs" class="p-3" style="height: 200px"></div>
          </div>

          <div class="row">
            <div class="col-12 col-lg-9 mb-4">
              <div class="card card-dark h-100">
                <div class="d-flex justify-content-between align-items-center mb-3">
                  <h4 class="m-0">
                    <svg
                      class="w-6 h-6 text-gray-800 dark:text-white"
                      aria-hidden="true"
                      xmlns="http://www.w3.org/2000/svg"
                      width="24"
                      height="24"
                      fill="none"
                      viewBox="0 0 24 24"
                    >
                      <path
                        stroke="currentColor"
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        stroke-width="2"
                        d="M3 15v4m6-6v6m6-4v4m6-6v6M3 11l6-5 6 5 5.5-5.5"
                      />
                    </svg>
                    Hist√≥rico de Mensagens
                  </h4>
                </div>
                <div class="chart-container">
                  <canvas id="chart"></canvas>
                </div>
              </div>
            </div>

            <div class="col-12 col-lg-3 mb-4">
              <div class="card card-dark h-100">
                <div class="d-flex justify-content-between align-items-center mb-3">
                  <h4 class="m-0">‚öôÔ∏è Status do Sistema</h4>
                  <button class="btn btn-outline-primary btn-sm" onclick="carregarHealthStatus()">
                    <svg
                      class="w-[30px] h-[30px] text-gray-800 dark:text-white"
                      aria-hidden="true"
                      xmlns="http://www.w3.org/2000/svg"
                      width="24"
                      height="24"
                      fill="none"
                      viewBox="0 0 24 24"
                    >
                      <path
                        stroke="currentColor"
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        stroke-width="1.9"
                        d="M17.651 7.65a7.131 7.131 0 0 0-12.68 3.15M18.001 4v4h-4m-7.652 8.35a7.13 7.13 0 0 0 12.68-3.15M6 20v-4h4"
                      />
                    </svg>
                  </button>
                </div>
                <ul class="list-group list-group-flush">
                  <li class="list-group-item d-flex justify-content-between align-items-center bg-transparent text-white">
                    <div>
                      Conex√£o WhatsApp
                      <small id="health-whatsapp-message" class="d-block text-muted">Verificando...</small>
                    </div>
                    <span id="health-whatsapp-status" class="badge rounded-pill bg-secondary">--</span>
                  </li>
                  <li class="list-group-item d-flex justify-content-between align-items-center bg-transparent text-white">
                    <div>
                      API de Intelig√™ncia Artificial
                      <small id="health-ai_api-message" class="d-block text-muted">Verificando...</small>
                    </div>
                    <span id="health-ai_api-status" class="badge rounded-pill bg-secondary">--</span>
                  </li>
                  <li class="list-group-item d-flex justify-content-between align-items-center bg-transparent text-white">
                    <div>
                      Sistema de Arquivos
                      <small id="health-filesystem-message" class="d-block text-muted">Verificando...</small>
                    </div>
                    <span id="health-filesystem-status" class="badge rounded-pill bg-secondary">--</span>
                  </li>
                </ul>
              </div>
            </div>
          </div>
          <div class="card card-dark">
            <div class="d-flex justify-content-between align-items-center mb-3">
              <h4 class="m-0">üìú Tabela de Hist√≥rico</h4>
              <button class="btn btn-outline-primary btn-sm" onclick="carregarMensagens()">
                <svg
                  class="w-[30px] h-[30px] text-gray-800 dark:text-white"
                  aria-hidden="true"
                  xmlns="http://www.w3.org/2000/svg"
                  width="24"
                  height="24"
                  fill="none"
                  viewBox="0 0 24 24"
                >
                  <path
                    stroke="currentColor"
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="1.9"
                    d="M17.651 7.65a7.131 7.131 0 0 0-12.68 3.15M18.001 4v4h-4m-7.652 8.35a7.13 7.13 0 0 0 12.68-3.15M6 20v-4h4"
                  />
                </svg>
              </button>
            </div>
            <table class="table table-hover">
              <thead class="table-dark">
                <tr>
                  <th>Grupo</th>
                  <th>Mensagem</th>
                  <th>Data/Hora</th>
                </tr>
              </thead>
              <tbody id="tabela-mensagens"></tbody>
            </table>
            <nav>
              <ul class="pagination justify-content-center pt-3" id="paginacao"></ul>
            </nav>
          </div>
        </div>

        <div class="tab-pane fade" id="grupos">
          <div class="row">
            <div class="col-md-6 mb-4 mb-md-0">
              <div class="card card-dark h-100">
                <h4 class="mb-3">‚úÖ Grupos Sincronizados</h4>
                <button class="btn btn-outline-primary btn-sm mb-2" onclick="carregarGruposSync()">
                  <svg
                    class="w-[30px] h-[30px] text-gray-800 dark:text-white"
                    aria-hidden="true"
                    xmlns="http://www.w3.org/2000/svg"
                    width="24"
                    height="24"
                    fill="none"
                    viewBox="0 0 24 24"
                  >
                    <path
                      stroke="currentColor"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="1.9"
                      d="M17.651 7.65a7.131 7.131 0 0 0-12.68 3.15M18.001 4v4h-4m-7.652 8.35a7.13 7.13 0 0 0 12.68-3.15M6 20v-4h4"
                    />
                  </svg>
                  Atualizar
                </button>
                <table class="table table-hover">
                  <thead class="table-dark">
                    <tr>
                      <th>Nome do Grupo</th>
                      <th class="text-end">A√ß√µes</th>
                    </tr>
                  </thead>
                  <tbody id="tabela-grupos-sync"></tbody>
                </table>
              </div>
            </div>
            <div class="col-md-6">
              <div class="card card-dark h-100">
                <h4 class="mb-3">üîó Grupos N√£o Sincronizados</h4>
                <button class="btn btn-outline-primary btn-sm mb-2" onclick="carregarGruposNaoSync()">
                  <svg
                    class="w-[30px] h-[30px] text-gray-800 dark:text-white"
                    aria-hidden="true"
                    xmlns="http://www.w3.org/2000/svg"
                    width="24"
                    height="24"
                    fill="none"
                    viewBox="0 0 24 24"
                  >
                    <path
                      stroke="currentColor"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="1.9"
                      d="M17.651 7.65a7.131 7.131 0 0 0-12.68 3.15M18.001 4v4h-4m-7.652 8.35a7.13 7.13 0 0 0 12.68-3.15M6 20v-4h4"
                    />
                  </svg>
                  Atualizar
                </button>
                <table class="table table-hover">
                  <thead class="table-dark">
                    <tr>
                      <th>Nome do Grupo</th>
                      <th class="text-end">A√ß√£o</th>
                    </tr>
                  </thead>
                  <tbody id="tabela-grupos-nao-sync"></tbody>
                </table>
              </div>
            </div>
          </div>
        </div>

        <div class="tab-pane fade" id="prompts">
          <div class="card card-dark">
            <h4 class="mb-3">‚úçÔ∏è Editando Prompts da IA</h4>
            <p class="text-muted">
              Use as vari√°veis <code>{{nomeGrupo}}</code> e <code>{{conteudoPDF}}</code> para inserir informa√ß√µes din√¢micas. A vari√°vel
              <code>{{conteudoPDF}}</code> s√≥ funciona no prompt "Com PDF".
            </p>

            <div class="mb-3">
              <label for="promptComPdf" class="form-label" style="color: whitesmoke">Prompt para grupos COM PDF associado:</label>
              <textarea class="form-control" id="promptComPdf" rows="8"></textarea>
            </div>

            <div class="mb-3">
              <label for="promptSemPdf" class="form-label" style="color: whitesmoke">Prompt gen√©rico para grupos SEM PDF:</label>
              <textarea class="form-control" id="promptSemPdf" rows="5"></textarea>
            </div>

            <button class="btn btn-warning" onclick="salvarPrompts()">
              <svg
                class="w-6 h-6 text-gray-800 dark:text-white"
                aria-hidden="true"
                xmlns="http://www.w3.org/2000/svg"
                width="24"
                height="24"
                fill="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  d="m7.4 3.736 3.43 3.429A5.046 5.046 0 0 1 12.133 7c.356.01.71.06 1.056.147l3.41-3.412a2.32 2.32 0 0 1 .451-.344A9.89 9.89 0 0 0 12.268 2a10.022 10.022 0 0 0-5.322 1.392c.165.095.318.211.454.344Zm11.451 1.54-.127-.127a.5.5 0 0 0-.706 0l-2.932 2.932c.03.023.05.054.078.077.237.194.454.41.651.645.033.038.077.067.11.107l2.926-2.927a.5.5 0 0 0 0-.707Zm-2.931 9.81c-.025.03-.058.052-.082.082a4.97 4.97 0 0 1-.633.639c-.04.036-.072.083-.115.117l2.927 2.927a.5.5 0 0 0 .707 0l.127-.127a.5.5 0 0 0 0-.707l-2.932-2.931Zm-1.443-4.763a3.037 3.037 0 0 0-1.383-1.1l-.012-.007a2.956 2.956 0 0 0-1-.213H12a2.964 2.964 0 0 0-2.122.893c-.285.29-.509.634-.657 1.013l-.009.016a2.96 2.96 0 0 0-.21 1 2.99 2.99 0 0 0 .488 1.716l.032.04a3.04 3.04 0 0 0 1.384 1.1l.012.007c.319.129.657.2 1 .213.393.015.784-.05 1.15-.192.012-.005.021-.013.033-.018a3.01 3.01 0 0 0 1.676-1.7v-.007a2.89 2.89 0 0 0 0-2.207 2.868 2.868 0 0 0-.27-.515c-.007-.012-.02-.025-.03-.039Zm6.137-3.373a2.53 2.53 0 0 1-.349.447l-3.426 3.426c.112.428.166.869.161 1.311a4.954 4.954 0 0 1-.148 1.054l3.413 3.412c.133.134.249.283.347.444A9.88 9.88 0 0 0 22 12.269a9.913 9.913 0 0 0-1.386-5.319ZM16.6 20.264l-3.42-3.421c-.386.1-.782.152-1.18.157h-.135c-.356-.01-.71-.06-1.056-.147L7.4 20.265a2.503 2.503 0 0 1-.444.347A9.884 9.884 0 0 0 11.732 22H12a9.9 9.9 0 0 0 5.044-1.388 2.515 2.515 0 0 1-.444-.348ZM3.735 16.6l3.426-3.426a4.608 4.608 0 0 1-.013-2.367L3.735 7.4a2.508 2.508 0 0 1-.349-.447 9.889 9.889 0 0 0 0 10.1 2.48 2.48 0 0 1 .35-.453Zm5.101-.758a4.959 4.959 0 0 1-.65-.645c-.034-.038-.078-.067-.11-.107L5.15 18.017a.5.5 0 0 0 0 .707l.127.127a.5.5 0 0 0 .706 0l2.932-2.933c-.029-.018-.049-.053-.078-.076Zm-.755-6.928c.03-.037.07-.063.1-.1.183-.22.383-.423.6-.609.046-.04.081-.092.128-.13L5.983 5.149a.5.5 0 0 0-.707 0l-.127.127a.5.5 0 0 0 0 .707l2.932 2.931Z"
                />
              </svg>
              Salvar Prompts
            </button>
          </div>
        </div>
      </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>
    <script src="/dashboard.js" defer></script>
  </body>
</html>
